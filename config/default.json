{
  "slack": {
    "token": "YOUR-KEY",
    "channel": "YOUR-CHANNEL"
  },
  "elasticsearch": {
    "host": "127.0.0.1:9200",
    "log": "info"
  },
  "offline": {
    "schedule": "*/30 * * * * *",
    "query": {
      "query": {
        "filtered": {
          "filter": {
            "bool": {
              "must": {
                "range": {
                  "@timestamp": {
                    "gte": "now-30s"
                  }
                }
              }
            }
          }
        }
      },
      "size": 0,
      "aggs": {
        "host": {
          "terms": {
            "field": "host",
            "size": 100
          }
        }
      }
    }
  },
  "ping": {
    "schedule": "*/30 * * * * *"
  },
  "cpu&memory": {
    "schedule": "*/60 * * * * *",
    "query": {
      "query": {
        "filtered": {
          "filter": {
            "bool": {
              "must": {
                "range": {
                  "@timestamp": {
                    "gte": "now-3m"
                  }
                }
              },
              "should": [{
                "term": {
                  "plugin": "cpu"
                }
              }, {
                "term": {
                  "plugin": "memory"
                }
              }]
            }
          }
        }
      },
      "size": 0,
      "aggs": {
        "host": {
          "terms": {
            "field": "host",
            "size": 100
          },
          "aggs": {
            "plugin": {
              "terms": {
                "field": "plugin",
                "size": 100
              },
              "aggs": {
                "type_instance": {
                  "terms": {
                    "field": "type_instance",
                    "size": 100
                  },
                  "aggs": {
                    "avg": {
                      "avg": {
                        "field": "value"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "alert": {
    "schedule": "*/30 * * * * *",
    "query": {
      "query": {
        "filtered": {
          "filter": {
            "or": [{
              "query": {
                "filtered": {
                  "query": {
                    "term": {
                      "status": "notified"
                    }
                  },
                  "filter": {
                    "bool": {
                      "must": {
                        "range": {
                          "timestamp": {
                            "gte": "now-15m"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }, {
              "query": {
                "filtered": {
                  "filter": {
                    "bool": {
                      "must": {
                        "range": {
                          "timestamp": {
                            "gte": "now-1m"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }]
          }
        }
      },
      "size": 0,
      "aggs": {
        "host": {
          "terms": {
            "field": "host",
            "size": 100
          },
          "aggs": {
            "type": {
              "terms": {
                "field": "type",
                "size": 100
              },
              "aggs": {
                "grade": {
                  "terms": {
                    "field": "grade",
                    "size": 100
                  },
                  "aggs": {
                    "status": {
                      "terms": {
                        "field": "status",
                        "size": 100
                      },
                      "aggs": {
                        "top_tag_hits": {
                          "top_hits": {
                            "sort": [{
                              "timestamp": {
                                "order": "desc"
                              }
                            }],
                            "_source": {
                              "include": []
                            },
                            "size": 1
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "cpu": {
    "warning": 30,
    "danger": 10
  },
  "memory": {
    "warning": 30,
    "danger": 10
  },
  "serverList": ["demo", "raspberrypi"]
}
